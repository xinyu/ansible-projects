#! /bin/bash

. /etc/rc.d/init.d/functions

RETVAL=0
PROG="alertmanager"
PATH="{{ alertmanager.path }}"
PROG_PATH="$PATH/$PROG"

OPTIONS=" -config.file=$PATH/alertmanager.yml "

start()
{
    if [ ! -x $PROG_PATH ]; then
        echo "$PROG_PATH is invalid."
        exit 5
    fi

    echo $"Starting $PROG_PATH ..."
    /usr/bin/nohup $PROG_PATH $OPTIONS &
    
    /usr/bin/ps -ef | /usr/bin/grep "$PROG_PATH" | /usr/bin/grep -v grep
    RETVAL=$?
    if [ $RETVAL -eq 0 ]; then
        success
    else
        failure
    fi
    
    return $RETVAL
}

stop()
{
   echo -n $"Stopping $PROG_PATH ... "

   /usr/bin/pkill -9 $PROG

   RETVAL=$?
   [ $RETVAL -eq 0 ]
   echo
}

restart() {
   stop
   start
}

case "$1" in
    start)
        start
        ;;
    stop)
        stop
        ;;
    restart)
        restart
        ;;
    *)
        echo $"Usage: $0 {start|stop|restart}"
        RETVAL=2
esac
exit $RETVAL
