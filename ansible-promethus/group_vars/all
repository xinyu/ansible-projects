---
# Variables here are applicable to all host groups

prometheus_install_path: /data/prometheus

grafana:
  path: /data/grafana

node_exporter:
  path: /opt/prometheus/node_exporter
  port: 9100

oms_exporter:
  path: /opt/prometheus/oms_exporter
  port: 9199

# Prometheus
# https://prometheus.io/docs/operating/configuration/

prometheus_config_global_scrape_interval: '15s'
prometheus_config_global_evaluation_interval: '30s'
prometheus_config_global_scrape_timeout: '10s'
prometheus_config_global_external_labels:
prometheus_config_rule_files:
  - "{{ prometheus_install_path }}/rules.d/*.rules.yml"

# Prometheus alert manager rules
# since Ansible uses double curly braces as well as Prometheus for
# variable interpolation in alerts use square brackets, those will be
# replaced to curly braces in task
prometheus_rules:
  - name: instancedown
    rules:
    - alert: InstanceDown
      expr: up == 0
      for: '60s'
      annotations:
        summary: 'Instance [[ $labels.instance ]] down'
        description: '[[ $labels.instance ]] of job [[ $labels.job ]] has been down for more than 60 seconds.'

# Allow Prometheus to disover alert managers
prometheus_config_alerting:
  alertmanagers:
  - static_configs:
    - targets:
      - localhost:9093

# Alertmanager
alertmanager:
  path: /data/alertmanager

prometheus_alert_manager_config_global:
  # # The smarthost and SMTP sender used for mail notifications.
  # smtp_smarthost: 'localhost:25'
  # smtp_from: 'alertmanager@example.org'
  # smtp_auth_username: 'alertmanager'
  # smtp_auth_password: 'password'
  # # The auth token for Hipchat.
  # hipchat_auth_token: '1234556789'
  # # Alternative host for Hipchat.
  # hipchat_url: 'https://hipchat.foobar.org/'

# The directory from which notification templates are read.
prometheus_alert_manager_config_templates:
  - "{{ alertmanager.path }}/*.tmpl"

# The root route on which each incoming alert enters.
prometheus_alert_manager_config_route:
  group_by: ['alertname', 'cluster']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 3h
  receiver: 'email-admin'

# Inhibition rules allow to mute a set of alerts given that another alert is
# firing.
# We use this to mute any warning-level notifications if the same alert is
# already critical.
prometheus_alert_manager_config_inhibit_rules:

# Prometheus alert manager receivers
# since Ansible uses double curly braces as well as Prometheus for
# variable interpolation in receivers use double square brackets,
# those will be replaced to curly braces.
prometheus_alert_manager_config_receivers:
  - name: email-admin
    email_configs:
      - to: test01@test.org
        from: testadmin@test.org
        smarthost: smtp.ym.163.com:25
        auth_username: "testadmin@test.org"
        auth_identity: "testadmin@test.org"
        auth_password: "password"

prometheus_alert_manager_config__file: "{{ alertmanager.path }}/alertmanager.yml"
# Alertmanager configuration file name. (default "alertmanager.yml")
prometheus_alert_manager_data__retention: '120h0m0s'
# How long to keep data for. (default 120h0m0s)
prometheus_alert_manager_log__level: 'info'
# Only log messages with the given severity or above. Valid levels: [debug, info, warn, error, fatal]. (default info)
prometheus_alert_manager_mesh__listen_address: '0.0.0.0:6783'
# mesh listen address (default "0.0.0.0:6783")
prometheus_alert_manager_mesh__nickname:
# peer nickname (default "$HOSTNAME")
prometheus_alert_manager_mesh__password:
# password to join the peer network (empty password disables encryption)
prometheus_alert_manager_mesh__peer:
# initial peers (may be repeated)
prometheus_alert_manager_mesh__peer_id:
# mesh peer ID (default: MAC address)
prometheus_alert_manager_storage__path: "{{ alertmanager.path }}"
# Base path for data storage. (default "data/")
prometheus_alert_manager_web__external_url:
# The URL under which Alertmanager is externally reachable
# (for example, if Alertmanager is served via a reverse proxy).
# Used for generating relative and absolute links back to Alertmanager itself.
# If the URL has a path portion, it will be used to prefix all HTTP endpoints served by Alertmanager.
# If omitted, relevant URL components will be derived automatically.
prometheus_alert_manager_web__listen_address: ':9093'
# Address to listen on for the web:erface and API. (default ":9093")
prometheus_alert_manager_web__route_prefix:
# Prefix for the internal routes of web endpoints. Defaults to path of -web.external-url.

